<!DOCTYPE html>
<html lang="bg">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
<title>DualPay ‚Äì –ò–∑—á–∏—Å–ª—è–≤–∞–Ω–µ –Ω–∞ —Ä–µ—Å—Ç–æ</title>

<!-- Tailwind -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Comfortaa&family=Montserrat&display=swap" rel="stylesheet">

<style>
body {
  font-family: 'Montserrat', sans-serif;
  background:#EDE7F6;
  margin:0;
  min-height:100vh;
  display:flex;
  align-items:center;       /* –≤–µ—Ä—Ç–∏–∫–∞–ª–µ–Ω —Ü–µ–Ω—Ç—ä—Ä */
  justify-content:center;   /* —Ö–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–µ–Ω —Ü–µ–Ω—Ç—ä—Ä */
  overflow-x:hidden;
  padding:1rem;             /* –∑–∞—â–∏—Ç–∞ –∑–∞ –º–∞–ª–∫–∏ –µ–∫—Ä–∞–Ω–∏ */
}

h1, #logo { font-family:'Comfortaa', cursive; }

#background {
  position:fixed;
  inset:0;
  display:grid;
  pointer-events:none;
  opacity:0.05;
  z-index:0;
}

.bg-symbol {
  font-size:40px;
  color:#006994;
  display:flex;
  justify-content:center;
  align-items:center;
  animation:float 10s ease-in-out infinite;
}

@keyframes float {
  0%,100% { transform:translate(0,0) rotate(0) scale(1); }
  50% { transform:translate(8px,8px) rotate(6deg) scale(1.1); }
}

/* App container ‚Äì compact */
#app {
  max-width:360px;
  margin:0;                 /* –º–∞—Ö–∞–º–µ auto —Ü–µ–Ω—Ç—Ä–∏—Ä–∞–Ω–µ—Ç–æ */
  padding:1rem 1rem 1.25rem;
  background:rgba(255,255,255,.65);
  backdrop-filter:blur(14px);
  border-radius:1rem;
  box-shadow:0 12px 25px rgba(0,0,0,.15);
  position:relative;
  z-index:1;
  background:rgba(255,255,255,.65);
  backdrop-filter:blur(14px);
  border-radius:1rem;
  box-shadow:0 12px 25px rgba(0,0,0,.15);
  position:relative;
  z-index:1;
}

#logo {
  background:#006994;
  color:#fff;
  padding:.35rem .8rem;
  border-radius:.75rem;
  font-size:1.4rem;
  display:inline-block;
}

.accent { color:#006994; }

input, select {
  font-size:.95rem;
}

.error {
  border:2px solid #dc2626;
}

#change-output {
  opacity:0;
  transition:.4s;
}
#change-output.visible {
  opacity:1;
}

.segmented {
  display:flex;
  border:2px solid #006994;
  border-radius:999px;
  overflow:hidden;
  width:max-content;
}
.segmented input { display:none; }
.segmented label {
  padding:.4rem 1.1rem;
  cursor:pointer;
  font-family:'Comfortaa';
  color:#006994;
}
.segmented input:checked + label {
  background:#006994;
  color:#fff;
}
</style>
</head>

<body>

<div id="background"></div>

<div id="app">

<header class="text-center mb-3">
  <div id="logo">‚Ç¨ ‚áÑ –ª–≤</div>
  <h1 class="text-xl mt-2 accent leading-snug">
    DualPay ‚Äì<br>–ò–∑—á–∏—Å–ª—è–≤–∞–Ω–µ –Ω–∞ —Ä–µ—Å—Ç–æ
  </h1>

  <!-- Install button -->
  <button id="installBtn"
    class="hidden mt-3 px-4 py-2 rounded-lg text-white text-sm font-semibold"
    style="background:#006994">
    üì≤ –ò–Ω—Å—Ç–∞–ª–∏—Ä–∞–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ
  </button>
</header>

<form class="space-y-3">

<div>
  <label class="font-semibold accent">–°—É–º–∞ –∑–∞ –ø–ª–∞—â–∞–Ω–µ</label>
  <div class="flex gap-2">
    <input id="sum" type="number" step="0.01" class="w-full rounded-md px-3 py-2 bg-blue-100">
    <select id="sumCur" class="rounded-md px-2 accent">
      <option value="BGN">–ª–≤</option>
      <option value="EUR">‚Ç¨</option>
    </select>
  </div>
</div>

<div>
  <label class="font-semibold accent">–ü–ª–∞—Ç–µ–Ω–æ –≤ –ª–≤</label>
  <input id="paidBGN" type="number" step="0.01" class="w-full rounded-md px-3 py-2">
</div>

<div>
  <label class="font-semibold accent">–ü–ª–∞—Ç–µ–Ω–æ –≤ ‚Ç¨</label>
  <input id="paidEUR" type="number" step="0.01" class="w-full rounded-md px-3 py-2">
</div>

<div>
  <label class="font-semibold accent">–í–∞–ª—É—Ç–∞ –∑–∞ —Ä–µ—Å—Ç–æ</label>
  <div class="segmented mt-1">
    <input type="radio" name="out" id="outBGN" checked>
    <label for="outBGN">–ª–≤</label>
    <input type="radio" name="out" id="outEUR">
    <label for="outEUR">‚Ç¨</label>
  </div>
</div>

<div id="error" class="text-red-600 font-semibold hidden">
  –ù–µ–¥–æ—Å—Ç–∞—Ç—ä—á–Ω–∞ –ø–ª–∞—Ç–µ–Ω–∞ —Å—É–º–∞
</div>

<div id="change-output">
  <div class="font-semibold accent text-lg">
    –†–µ—Å—Ç–æ: <span id="mainChange">0.00 –ª–≤</span>
  </div>
  <div class="text-sm text-gray-600">
    ‚âà <span id="secChange">0.00 ‚Ç¨</span>
  </div>
</div>

</form>

<footer class="mt-4 text-center text-xs text-gray-600">
  –ö—É—Ä—Å: 1 EUR = 1.95583 BGN<br>
  ¬© –ù–∏–∫–æ–ª–∞ –®–∞–∫–µ–í
</footer>

</div>

<script>
const RATE = 1.95583;

/* background */
const bg = document.getElementById('background');
function bgGrid(){
  const size=80;
  const cols=Math.ceil(innerWidth/size);
  const rows=Math.ceil(innerHeight/size);
  bg.style.gridTemplateColumns=`repeat(${cols},${size}px)`;
  bg.innerHTML='';
  let t=true;
  for(let i=0;i<cols*rows;i++){
    const s=document.createElement('div');
    s.className='bg-symbol';
    s.textContent=t?'‚Ç¨':'–ª–≤';
    t=!t;
    if(i%cols===cols-1) t=!t;
    bg.appendChild(s);
  }
}
bgGrid();
addEventListener('resize',bgGrid);

/* calculator */
const sum=document.getElementById('sum');
const sumCur=document.getElementById('sumCur');
const paidBGN=document.getElementById('paidBGN');
const paidEUR=document.getElementById('paidEUR');
const main=document.getElementById('mainChange');
const sec=document.getElementById('secChange');
const out=document.getElementById('change-output');
const err=document.getElementById('error');

function calc(){
  const s=parseFloat(sum.value)||0;
  const sbgn=sumCur.value==='BGN'?s:s*RATE;
  const paid=(parseFloat(paidBGN.value)||0)+(parseFloat(paidEUR.value)||0)*RATE;

  if(paid<sbgn){
    err.classList.remove('hidden');
    out.classList.remove('visible');
    return;
  }
  err.classList.add('hidden');

  const ch=paid-sbgn;
  const bgn=document.getElementById('outBGN').checked;

  main.textContent=(bgn?ch:ch/RATE).toFixed(2)+(bgn?' –ª–≤':' ‚Ç¨');
  sec.textContent=(bgn?(ch/RATE):ch).toFixed(2)+(bgn?' ‚Ç¨':' –ª–≤');
  out.classList.add('visible');
}

[sum,sumCur,paidBGN,paidEUR,outBGN,outEUR].forEach(e=>e.addEventListener('input',calc));

/* PWA install */
let deferred;
const installBtn=document.getElementById('installBtn');

addEventListener('beforeinstallprompt',e=>{
  e.preventDefault();
  deferred=e;
  installBtn.classList.remove('hidden');
});

installBtn.onclick=async()=>{
  deferred.prompt();
  await deferred.userChoice;
  installBtn.classList.add('hidden');
};

/* manifest + SW */
const iconCanvas=document.createElement('canvas');
iconCanvas.width=128;iconCanvas.height=128;
const c=iconCanvas.getContext('2d');
c.fillStyle='#006994';
c.fillRect(0,0,128,128);
c.fillStyle='#fff';
c.font='bold 48px Comfortaa';
c.textAlign='center';
c.textBaseline='middle';
c.fillText('‚Ç¨‚áÑ–ª–≤',64,64);
const icon=iconCanvas.toDataURL();

const manifest={
  name:'DualPay',
  short_name:'DualPay',
  start_url:".",
  display:'standalone',
  theme_color:'#006994',
  background_color:'#EDE7F6',
  icons:[{src:icon,sizes:'128x128',type:'image/png'}]
};
const mURL=URL.createObjectURL(new Blob([JSON.stringify(manifest)],{type:'application/json'}));
const ml=document.createElement('link');
ml.rel='manifest';ml.href=mURL;
document.head.appendChild(ml);

if('serviceWorker'in navigator){
  const sw=`
    self.addEventListener('fetch',e=>{
      e.respondWith(caches.match(e.request).then(r=>r||fetch(e.request)))
    });
  `;
  navigator.serviceWorker.register(URL.createObjectURL(new Blob([sw],{type:'text/js'})));
}
</script>

</body>
</html>

